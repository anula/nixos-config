# GEMINI.md - Context for AI Agents

This file provides high-level context, architectural guidelines, and conventions for AI agents working on this NixOS configuration repository.

## Project Overview

This is a personal NixOS configuration repository managed using **Nix Flakes** and **Home Manager**. It defines the system state (packages, services, configuration) for one or more physical machines and the user environments within them.

## Architecture

The project follows a modular structure separating system-level (NixOS) and user-level (Home Manager) configurations.

*   **Entry Point**: `flake.nix` is the source of truth, defining inputs (dependencies like `nixpkgs`) and outputs (`nixosConfigurations`).
*   **System Configuration (`hosts/`)**:
    *   Contains configuration for specific machines (e.g., `hosts/kawerna/`).
    *   `common.nix`: Shared settings applicable to all hosts.
    *   `hardware-configuration.nix`: Generated by NixOS installation, specific to the physical hardware.
*   **User Configuration (`users/`)**:
    *   Contains Home Manager configurations for users (e.g., `users/anula/`).
    *   `res/`: Stores raw dotfiles (e.g., `vimrc`, `tmux.conf`) referenced by the Nix config.

## Key Technologies

*   **NixOS**: The operating system.
*   **Nix Flakes**: For reproducible dependency management and project structure.
*   **Home Manager**: For managing user environments and dotfiles.
*   **Jujutsu (jj)**: The version control system used for this repository (interacts with the Git backend).

## Development Conventions & Rules

**Strict Adherence Required:**

1.  **Line Length Limit**:
    *   **MAXIMUM 80 COLUMNS per line.**
    *   This applies to code, comments, and documentation.
    *   Break long lines intelligently (e.g., in lists, function arguments, or string literals).

2.  **Modularity**:
    *   Avoid monolithic configuration files.
    *   Split functionality into logical modules (e.g., `graphics.nix`, `podman.nix`, `neovim/default.nix`) and import them.

3.  **Comments**:
    *   Focus on **WHY** a configuration exists, especially if it's a workaround or non-standard setting.
    *   Example: Explain why specific firewall ports are opened for Steam.

4.  **Reproducibility**:
    *   Prefer declarative configuration over imperative scripts.
    *   Ensure new dependencies are added to `flake.nix` or the relevant `default.nix`.

## Operational Tasks

### Adding a New Host
1.  Create `hosts/<hostname>/`.
2.  Copy the machine's generated `hardware-configuration.nix`.
3.  Create `hosts/<hostname>/default.nix` (reference existing hosts).
4.  Register the new host in `flake.nix` under `nixosConfigurations`.

### Adding a New User
1.  Create `users/<username>/`.
2.  Create `users/<username>/default.nix`.
3.  Import the user module in the relevant host configuration.

## Version Control
*   Use `jj` commands for version control operations when instructed.
*   Ensure atomic commits that describe the *intent* of the change.
